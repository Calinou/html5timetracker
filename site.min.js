$(document).ready(function(){var myAudio=new Audio("alert.mp3");var worked=0;var minToWork;var nextCycle;if(localStorage.cycle){cycle=localStorage.cycle;minToWork=cycle}else{minToWork=30;cycle=minToWork;nextCycle=cycle}var cycle;var count=0;var openAlert=function(){myAudio.play();$("body").removeClass("working").addClass("log");$("#new").prop("checked",true);$("#what").focus()};var logTime=function(){$("body").removeClass("working").addClass("log");$("#new").prop("checked",true);$("#what").focus()};var cancelTimer=function(where){$("body").removeClass("working").addClass(where)};$("#timer span").countdown({until:0,format:"MS",compact:true,onExpiry:openAlert});if(typeof(Storage)!==undefined){for(var key in localStorage){if(key=="count"||key.indexOf("task")===-1){continue}$("#done").prepend(localStorage.getItem(key))}if(localStorage.count){$(".count").text(localStorage.count);count=localStorage.count;$("body").addClass("list")}else{$("body").addClass("new")}}$(".set-cycle").on("click",function(){$("body").addClass("settings-open");$("#cycle").val(localStorage.cycle);return false});$(".set-next").on("click",function(){$("body").addClass("settings-open");$("#nextCycle").val(localStorage.nextCycle);return false});$("#cycle").on("input",function(event){this.value=this.value.replace(/[^0-9]/g,"");cycle=$(this).val()});$("#nextCycle").on("input",function(event){this.value=this.value.replace(/[^0-9]/g,"");nextCycle=$(this).val()});$("#cycle-form").submit(function(){if($("#cycle").val()===""){$("#cycle").val("30");localStorage.setItem("cycle",30);localStorage.setItem("nextCycle",30)}else{localStorage.setItem("cycle",cycle);localStorage.setItem("nextCycle",cycle)}minToWork=localStorage.cycle;$("body").removeClass("settings-open");return false});$("#next-form").submit(function(){localStorage.setItem("nextCycle",nextCycle);nextCycle=localStorage.nextCycle;$("body").removeClass("settings-open");return false});$("#settings .overlay").on("click",function(){$("body").removeClass("settings-open");$("#cycle").val(localStorage.cycle);$("#nextCycle").val(localStorage.nextCycle)});$(".btn-start").on("click",function(){$("body").removeClass().addClass("working");$("#timer span").countdown("option",{until:+cycle*60,onExpiry:openAlert});$("#actions span").hide();$("#reset").show();return false});$("#end").on("click",function(){worked=$("#timer span").countdown("getTimes");$("#timer span").countdown("option",{until:0,onExpiry:logTime});return false});$("#cancel").on("click",function(){if(localStorage.count){$("#timer span").countdown("option",{until:0,onExpiry:null});cancelTimer("list")}else{$("#timer span").countdown("option",{until:0,onExpiry:null});cancelTimer("new")}return false});$("#logActivity").submit(function(){var task=$("#what").val();var d=new Date();var hour=("0"+d.getHours()).slice(-2);var min=("0"+d.getMinutes()).slice(-2);var timeWorked;count++;localStorage.count=count;myAudio.currentTime=0;myAudio.pause();if(typeof worked[5]!=="number"){timeWorked=0}else{timeWorked=worked[5]}var text="<li><h6>"+hour+":"+min+"</h6><br /><p>"+task+"<small>"+(cycle-timeWorked)+" minutes</p></li>";if(nextCycle!==cycle){cycle=localStorage.nextCycle;localStorage.setItem("cycle",localStorage.nextCycle)}if(count<10){localStorage.setItem("task0"+count,text)}else{localStorage.setItem("task"+count,text)}$("#done").prepend(text);if($("#new").is(":checked")){$("#timer span").countdown("option",{until:+cycle*60});$("body").removeClass("log").addClass("working")}else{$("body").removeClass("log").addClass("list")}return false});$("#reset").on("click",function(){$(this).hide();$(this).siblings("span").show();return false});$("#actions .confirm").on("click",function(){for(var key in localStorage){if(key==="nextCycle"||key==="cycle"){continue}localStorage.removeItem(key)}count=0;$("#done").html("");$("body").removeClass().addClass("new");$(".count").text(count);$(this).parent().hide();$(this).parent().siblings("#reset").show();return false});$("#actions .cancel").on("click",function(){$(this).parent().hide();$(this).parent().siblings("#reset").show();return false});$(window).blur(function(){myAudio.addEventListener("ended",function(){this.currentTime=0;this.play()},false)});$(window).focus(function(){myAudio.addEventListener("ended",function(){this.currentTime=0;this.pause()},false);myAudio.pause();myAudio.currentTime=0})});